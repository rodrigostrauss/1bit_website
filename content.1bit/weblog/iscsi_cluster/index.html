

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
  <head>
<meta charset="utf-8">

<META NAME="author" CONTENT="Rodrigo Strauss">
<META NAME="ROBOTS" CONTENT="ALL">
    <title>Como montar um servidor iSCSI Linux  ::::  Rodrigo Strauss :: www.1bit.com.br</title>
    <link href="../../../1bit.css" type="text/css" rel="stylesheet">
    <link rel="alternate" type="text/xml" title="RSS" href="../../../weblog_rss.1bit">
</head>
  <body style="margin:0px 0px 0px 0px" bgcolor="#FFFFFF">
    <table cellspacing="0" cellpadding="0" width="100%" border="0">
        <tr>
          <td class="header" valign="middle" bgcolor="#ffffff" height="77" colspan="2">&nbsp;
<a href="../../../"><img src="../../../images/logo_novo_2.png" border="0" alt="logo" /></a>

          </td>
        </tr>
        <tr>
          <td class="topmenu"></td>
          <td class="topmenu" align="right" height="30">
		    <a class="top_menu_link" href="content.1bit/contact">Contato</a> 
			<span class="menusep">|</span>
            
            <a class="top_menu_link" href="content.1bit/about">Sobre...</a>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          </td>
        </tr>
        <tr>
          <td class="topmenu"></td>
          <td>
          <table style="MARGIN: 0px" cellspacing="0" cellpadding="0" width="100%" border="0">
            <tr>
              <td><img src="../../../images/rebarba1.png" alt="rebarba"></td>
              <td align="right"><img src="../../../images/rebarba2.png" alt="rebarba"></td>
              </tr>
            </table>
          </td>
        </tr>
        <tr>
          <td class="menu" valign="top" width="175">

<div class="left_menu_section">
 <h2><a href="../../#artigos" style="text-decoration:none;">Artigos</a></h2>
</div>

<div class="left_menu_section">
 <h2><a href="content.1bit/weblog" style="text-decoration:none;">Blog</a></h2>
</div>

<div class="left_menu_section">
 <h2><a href="content.1bit/opensource" style="text-decoration:none;">Open Source</a></h2>
</div>

<!-- 
<div class="left_menu_section">
 <h2><a href="content.1bit/aulas" style="text-decoration:none;">Aulas online (ou nÃ£o) </a></h2>
</div>
-->


<div id="google_translate_element"></div><script>
function googleTranslateElementInit() {
  new google.translate.TranslateElement({
    pageLanguage: 'pt',
    gaTrack: true,
    gaId: 'UA-75310-1',
  }, 'google_translate_element');
}
</script><script src="../..//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<br>

<!-- SiteSearch Google -->
<form method="get" action="http://www.google.com.br/custom" target="_top">
<table border="0" bgcolor="#eeeeee">
<tr><td nowrap="nowrap" valign="top" align="left" height="32">
<a href="http://www.google.com/">
<img src="http://www.google.com/logos/Logo_25wht.gif" border="0" alt="Google" align="middle"></img></a>
<br/>
<input type="hidden" name="domains" value="www.1bit.com.br"></input>
<label for="sbi" style="display: none">Digite os termos da sua pesquisa</label>
<input type="text" name="q" size="23" maxlength="255" value="" id="sbi"></input>
</td></tr>
<tr>
<td nowrap="nowrap">
<table>
<tr>
<td>
<input type="radio" name="sitesearch" value="" id="ss0"></input>
<label for="ss0" title="Pesquisar na web"><font size="-2" color="black">Web</font></label></td>
<td>
<input type="radio" name="sitesearch" value="www.1bit.com.br" checked id="ss1"></input>
<label for="ss1" title="Pesquisar www.1bit.com.br"><font size="-2" color="black">www.1bit.com.br</font></label></td>
</tr>
</table>
<label for="sbb" style="display: none">Enviar formulÃ¡rio de pesquisa</label>
<input type="submit" name="sa" value="Pesquisar" id="sbb"></input>
<input type="hidden" name="client" value="pub-2589539519655496"></input>
<input type="hidden" name="forid" value="1"></input>
<input type="hidden" name="ie" value="ISO-8859-1"></input>
<input type="hidden" name="oe" value="ISO-8859-1"></input>
<input type="hidden" name="cof" value="GALT:#0066CC;GL:1;DIV:#999999;VLC:336633;AH:center;BGC:FFFFFF;LBGC:FFFFFF;ALC:0066CC;LC:0066CC;T:000000;GFNT:666666;GIMP:666666;LH:50;LW:120;L:http://www.1bit.com.br/images/logo_novo_2.png;S:http://;FORID:1"></input>
<input type="hidden" name="hl" value="pt"></input>
</td></tr></table>
</form>
<!-- SiteSearch Google -->
<br>

<br>
<br>
<center>

<br><br><br>

<!--
<a href="http://whos.amung.us/show/xopqoakh"><img src="http://whos.amung.us/cwidget/xopqoakh/fffffff6915a.png" alt="page counter" width="81" height="29" border="0" /></a>
-->

</center>



<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
          </td>
          <td valign="top">
<div class="content">
<h4><a href="content.1bit/weblog" style="text-decoration:none;">Rodrigo Strauss :: Blog</a></h4>
<table border="0">
<tr>
<!-- 
<td width="60">

<a style="text-decoration:none;" href="../../weblog_rss.1bit"><img src="../../../images/xml.gif" border="0"/></a>
</td>
-->

<td>



</td>

<td>




</td>

<td align="right">




<!--

<script type="text/javascript">
google_ad_client = "pub-2589539519655496";
google_ad_width = 468;
google_ad_height = 15;
google_ad_format = "468x15_0ads_al";
google_ad_channel = "";
google_color_border = "FFFFFF";
google_color_bg = "FFFFFF";
google_color_link = "FF5000";
google_color_text = "000000";
google_color_url = "FF5000";
</script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
-->






</td>
</tr>
</table>
<br>
<h5>Como montar um servidor iSCSI Linux</h5><p>Um dos problemas que eu sempre tive desenvolvendo coisas para o <a href="http://www.microsoft.com/windowsserver2003/enterprise/clustering.mspx">Windows Server  Cluster</a> foi a disponibilidade de servidores de testes. O problema é que é necessário ter um storage compartilhado entre os nós do cluster, e como um storage não é lá algo muito barato, já dá para imaginar qual é o problema...</p>

<p>Uma solução para esse problema é o iSCSI, o SCSI sobre IP. Ou seja, ao invés de precisar de um storage com fiber channel ou algo assim, qualquer coisa que fale o protocolo iSCSI resolve. Isso facilita MUITO a vida de quem precisa de algo simples para testes ou usos não-produção - você não precisa criar disks, volumes, aggregates, RAIDs e eteceteras, é só exportar um disco.<p>

<p>Uma solução fácil é montar um servidor Linux dedicado para iSCSI - e você pode usar o VMWare Server ou o ESX para isso. Se você não tem ainda um Linux instalado, eu sugiro o Ubuntu Server. É bem fácil de instalar, e desmarcando todas as opções de serviços no setup (LAMP Server, Samba Server, etc), com 400MB de HD você já tem um server rodando. Mesmo que você seja um usuário Windows e não entenda nada de Linux, um google por "bash tutorial", a receita de bolo que eu vou passar, e uma procurada no <a href="http://www.howtoforge.com/"> How-To Forge</a> resolve seu problema. Nem que seja até você encontrar um iSCSI Target para Windows - eu não achei nenhum grátis ou open source.</p>

<p>Na parte client (Windows) tudo que você precisa fazer é instalar o <a href="http://www.microsoft.com/windowsserver2003/technologies/storage/iscsi/default.mspx">iSCSI Initiator</a> da Microsoft. Eu testei no Windows Server 2003. O Initiator já vem junto com o Vista (e acredito que deva vir junto com o Windows Server 2008 também).

<p>Para o server Linux, usaremos o <a href="http://iscsitarget.sourceforge.net/">iSCSI Enterprise Target</a> (ietd), uma implementação open source do protocolo iSCSI. Para garantir que teremos sempre a última versão, compilaremos os fontes diretamente do Subversion do SourgeForge ao invés de usar os pacotes pré compilados da sua distribuição favorita do Linux.</p>

<p>Depois de ter seu Linux instalado e rodando, siga a seguinte receita de bolo:</p>

<ul>
<li>Certifique-se que você é root (faça login como tal, ou use "su -" ou "sudo -i").</li>
<li>Vamos precisar do client do Subversion, OpenSSL, GCC e uns header do kernel do Linux. No Ubuntu/Debian, um <i>"apt-get install subversion linux-headers-2.6.22-14-server libssl-dev linux-libc-dev gcc make"</i> resolve.</li>
<li>Baixe os fontes diretamente do Subversion do pessoal do ietd. <i>"svn checkout svn://svn.berlios.de/iscsitarget/trunk"</i>.</li>
<li>Agora é só compilar e instalar. Entre no diretório <i>trunk</i> e <i>"make all install install-initd"</i>.</li>
</ul>

<p>Agora que tudo está instalado, é só editar o arquivo de configuração, que fica em /etc/ietd.conf. Ele é bem fácil de entender, e já tem um exemplo comentado lá dentro. Como ilustração, segue o arquivo de configuração que eu montei para meus clusters de teste. São 6 discos, 3 para cada cluster:</p>

<div class="code">
<pre>
#
# developers
#
Target iqn.2007-12.net.axur:ams.dev.storage1
  Lun 0 Path=/storage/ams.dev.storage1,Type=fileio

Target iqn.2007-12.net.axur:ams.dev.storage2
  Lun 1 Path=/storage/ams.dev.storage2,Type=fileio

Target iqn.2007-12.net.axur:ams.dev.storage3
  Lun 2 Path=/storage/ams.dev.storage3,Type=fileio


#
# testers
#
Target iqn.2007-12.net.axur:ams.test.storage1
  Lun 3 Path=/storage/ams.test.storage1,Type=fileio

Target iqn.2007-12.net.axur:ams.test.storage2
  Lun 4 Path=/storage/ams.test.storage2,Type=fileio

Target iqn.2007-12.net.axur:ams.test.storage3
  Lun 5 Path=/storage/ams.test.storage3,Type=fileio
</pre>
</div>

<p>Eu criei uma pasta /storage, e lá criei um arquivo para cada disco. Como é necessário criar os arquivos já com o tamanho do disco, é só usar o comando <i>dd</i>. <i>"dd if=/dev/zero of=storage2 bs=1M count=400"</i>, por exemplo, cria um arquivo storage2 com 400 MB. Para entender como funcionam os identificadores dos disco, veja o <a href="http://en.wikipedia.org/wiki/Iscsi">artigo sobre iSCSI da Wikipedia</a>. Você pode exportar um disco físico inteiro se quiser, veja na documentação do ietd.</p>

<p>Depois disso é só reinic... Ops, desculpa, essa é a parte Linux :-). Um <i>"/etc/init.d/iscsi-target start"</i> e tudo está funcionando. Feito isso, você precisa adicionar o servidor Linux como "Target Portal" no iSCSI Initiator do Windows, e na aba "Targets", fazer Log On para o Windows disponibilizar os discos. Depois disso, vá ao "Computer Management" >> "Disk Management" e inicialize/particione/formate seus novos discos como quiser.</p>

<p>Outra opção é usar o OpenFiler ou o FreeNas, que são distribuições Linux e BSD respectivamente, que além de exportar iSCSI funcionam como storage server. Eles têm serviços para CIFS (protocolo usado pelo Windows), NFS, FTP, etc, etc. Mas se você precisa só de iSCSI, um Linux e os passos que eu descrevi é tudo que você precisa.</p><br><p class="datetime">Em 02/01/2008 19:19, por  Rodrigo Strauss </p>
</div>
          </td>
        </tr>



<tr>
<td class="topmenu"></td>
<td>
<br>
<center>

<script type="text/javascript"><!--
google_ad_client = "pub-2589539519655496";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_type = "text";
google_ad_channel = "";
google_color_border = "FFFFFF";
google_color_bg = "FFFFFF";
google_color_link = "FF5000";
google_color_text = "000000";
google_color_url = "FF5000";
google_ui_features = "rc:6";
//-->
</script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>

</center>
</td>
</tr>

<tr>
 <td class="topmenu"></td>
 <td>
  <table style="margin: 0px" cellspacing="0" cellpadding="0" width="100%" border="0">
   <tr>
    <td><img src="../../../images/rebarba3.png"></td>
    <td align="right"><img src="../../../images/rebarba4.png"></td>
   </tr>
  </table>
 </td>
</tr>

<tr><td class="topmenu">&nbsp;</td><td class="topmenu">&nbsp;</td></tr>
<tr><td class="topmenu">&nbsp;</td><td>
<table style="MARGIN: 0px" cellspacing="0" cellpadding="0" width="100%" border="0">
            <tr>
              <td><img src="../../../images/rebarba1.png"></td>
              <td align="right"><img src="../../../images/rebarba2.png"></td>
              </tr>
            </table>
</td>
</tr>
 <tr><td class="topmenu">&nbsp;</td>
<td>

<div class="content">
<a name="comments"></a><h5>Comentários</h5><div class="post_comment">
<a name="2218"></a><B>Olavo</B>  | em 29/02/2008 | <a rel="nofollow" href="../#2218">#</a><br>
Legal, mas é possível também utilizar apenas o StarWind (www.rocketdivision.com/wind.html) e eliminar a necessidade de utilizar o linux.<br><br>[]s
</div>
<div class="post_comment_strauss">
<a name="2219"></a><B>Rodrigo Strauss</B>  | <a rel="nofollow" href="http://www.1bit.com.br">website</a> | <a rel="nofollow" href="mailto:rodrigo@1bit.com.br">e-mail</a> | em 29/02/2008 | <a rel="nofollow" href="../#2219">#</a><br>
Legal! Já testou?
</div>
<div class="post_comment">
<a name="2851"></a><B>Cesar Mello</B>  | <a rel="nofollow" href="mailto:cmello@gmail.com">e-mail</a> | em 16/09/2011 | <a rel="nofollow" href="../#2851">#</a><br>
Oi Strauss! Aqui é o César Mello de Porto Alegre. Estava pesquisando por iScsi e achei esse post no teu blog. Muito bom, parabéns!<br><br>E aí como vão as coisas?<br><br>Abraço<br>César
</div>
<div class="post_comment">
<a name="3127"></a><B>Renato Mendonça</B>  | em 07/02/2019 | <a rel="nofollow" href="../#3127">#</a><br>
Belo Post, obrigado
</div>

<h5>Algo a dizer?</h5>
<script language="JavaScript">
function setCookie(name, value, expires, path, domain, secure) {
  var curCookie = name + "=" + escape(value) +
      ((expires) ? "; expires=" + expires.toGMTString() : "") +
      ((path) ? "; path=" + path : "") +
      ((domain) ? "; domain=" + domain : "") +
      ((secure) ? "; secure" : "");
  document.cookie = curCookie;
}

function getCookie(name) {
  var dc = document.cookie;
  var prefix = name + "=";
  var begin = dc.indexOf("; " + prefix);
  if (begin == -1) {
    begin = dc.indexOf(prefix);
    if (begin != 0) return null;
  } else
    begin += 2;
  var end = document.cookie.indexOf(";", begin);
  if (end == -1)
    end = dc.length;
  return unescape(dc.substring(begin + prefix.length, end));
}

function deleteCookie(name, path, domain) {
  if (getCookie(name)) {
    document.cookie = name + "=" +
    ((path) ? "; path=" + path : "") +
    ((domain) ? "; domain=" + domain : "") +
    "; expires=Thu, 01-Jan-70 00:00:01 GMT";
  }
}

function CheckName()
{
  if(comment_form.name.value == '')
  {
    alert('Você esqueceu de informar o seu nome...');
    comment_form.name.focus();
    
    return false;
  }

  if(comment_form.comment.value == '')
  {
    alert('O que você acha de escrever o comentário antes de tentar enviá-lo?');
    comment_form.comment.focus();
    
    return false;
  }

  var now = new Date();

  // um ano
  now.setTime(now.getTime() + 365 * 24 * 60 * 60 * 1000);
  setCookie("name", comment_form.name.value, now);
  setCookie("email", comment_form.email.value, now);
  setCookie("link", comment_form.link.value, now);
  setCookie("hideemail", comment_form.hideemail.value, now);

  return true;
}

</script>
<form name="comment_form" method="POST" action="/comment.html" onsubmit="return CheckName();">
<input type="hidden" name="article" value="weblog/1199312361"/>

Nome:<br/>
<input type="text" name="name" style="width: 250px;"/><br/>
<br/>

Site:<br/>
<input type="text" name="link" style="width: 250px;" /><br/>
<br/>

E-mail:<br/>
<input type="text" name="email" style="width: 250px;" />
<br/><br/>

Escreva o número vinte e seis:<br/>
<input type="text" name="idade" style="width: 250px;" />
<br/><br/>

<input type="checkbox" name="hideemail"/>&nbsp;Não mostre meu e-mail no site, não serve pra nada mesmo...
<br/><br/>

Comentário<br/>
<textarea style="WIDTH: 500px; HEIGHT: 300px" name="comment" rows="18" cols="50"></textarea><br/>
<br/>
<input type="submit" value="Dizer"/><br/><br/><br/>
<div style="width:500px;font-size:8pt;">
<b>Os comentários devem ser sobre assuntos relativos ao post</b>, eu provavelmente apagarei comentários totalmente offtopic. Se quiser me enviar uma mensagem, use o <a href="../../../content.1bit/contact">formulário de contato</a>. E não esqueça: isso é um site pessoal e eu me reservo o direito de apagar qualquer comentário ofensivo ou inapropriado.
</div>
</form>

<script language="JavaScript">
// cookie de nome
var name = getCookie("name");
if (name && name != 'null')
{
  comment_form.name.value = name;
  comment_form.email.value = getCookie("email");
  comment_form.link.value = getCookie("link");
  comment_form.hideemail.value = getCookie("hideemail");
}

</script>

</div>

</td></tr>



















<tr>
          <td class="topmenu"></td>
          <td>
          <table style="margin: 0px" cellspacing="0" cellpadding="0" width="100%" border="0">
            <tr>
              <td><img src="../../../images/rebarba3.png" alt="rebarba"></td>
              <td align="right"><img src="../../../images/rebarba4.png" alt="rebarba"></td>
            </tr>
          </table>
          </td>
        </tr>

        <tr>
          <td class="topmenu">&nbsp;</td>
          <td class="topmenu" height="25" align="right" style="color:#999999;">
::::
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          </td>
        </tr>
    </table>
  </body>
</html>
