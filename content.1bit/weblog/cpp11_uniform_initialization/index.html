

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
  <head>
<meta charset="utf-8">

<META NAME="author" CONTENT="Rodrigo Strauss">
<META NAME="ROBOTS" CONTENT="ALL">
    <title>C++11: Inicialização uniforme  ::::  Rodrigo Strauss :: www.1bit.com.br</title>
    <link href="../../../1bit.css" type="text/css" rel="stylesheet">
    <link rel="alternate" type="text/xml" title="RSS" href="../../../weblog_rss.1bit">
</head>
  <body style="margin:0px 0px 0px 0px" bgcolor="#FFFFFF">
    <table cellspacing="0" cellpadding="0" width="100%" border="0">
        <tr>
          <td class="header" valign="middle" bgcolor="#ffffff" height="77" colspan="2">&nbsp;
<a href="../../../"><img src="../../../images/logo_novo_2.png" border="0" alt="logo" /></a>

          </td>
        </tr>
        <tr>
          <td class="topmenu"></td>
          <td class="topmenu" align="right" height="30">
		    <a class="top_menu_link" href="../../../content.1bit/contact">Contato</a> 
			<span class="menusep">|</span>
            
            <a class="top_menu_link" href="../../../content.1bit/about">Sobre...</a>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          </td>
        </tr>
        <tr>
          <td class="topmenu"></td>
          <td>
          <table style="MARGIN: 0px" cellspacing="0" cellpadding="0" width="100%" border="0">
            <tr>
              <td><img src="../../../images/rebarba1.png" alt="rebarba"></td>
              <td align="right"><img src="../../../images/rebarba2.png" alt="rebarba"></td>
              </tr>
            </table>
          </td>
        </tr>
        <tr>
          <td class="menu" valign="top" width="175">

<div class="left_menu_section">
 <h2><a href="../../../#artigos" style="text-decoration:none;">Artigos</a></h2>
</div>

<div class="left_menu_section">
 <h2><a href="../../../content.1bit/weblog_archive" style="text-decoration:none;">Blog</a></h2>
</div>

<div class="left_menu_section">
 <h2><a href="../../../content.1bit/opensource" style="text-decoration:none;">Open Source</a></h2>
</div>

<!-- 
<div class="left_menu_section">
 <h2><a href="content.1bit/aulas" style="text-decoration:none;">Aulas online (ou não) </a></h2>
</div>
-->


<br>
<br>
<br>
<center>

<!--
<a href="http://whos.amung.us/show/xopqoakh"><img src="http://whos.amung.us/cwidget/xopqoakh/fffffff6915a.png" alt="page counter" width="81" height="29" border="0" /></a>
-->

</center>



<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
          </td>
          <td valign="top">
<div class="content">
<h4><a href="../../../content.1bit/weblog_archive" style="text-decoration:none;">Rodrigo Strauss :: Blog</a></h4>
<table border="0">
<tr>
<!-- 
<td width="60">

<a style="text-decoration:none;" href="../../weblog_rss.1bit"><img src="../../../images/xml.gif" border="0"/></a>
</td>
-->

<td>



</td>

<td>




</td>

<td align="right">




<!--

<script type="text/javascript">
google_ad_client = "pub-2589539519655496";
google_ad_width = 468;
google_ad_height = 15;
google_ad_format = "468x15_0ads_al";
google_ad_channel = "";
google_color_border = "FFFFFF";
google_color_bg = "FFFFFF";
google_color_link = "FF5000";
google_color_text = "000000";
google_color_url = "FF5000";
</script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
-->






</td>
</tr>
</table>
<br>
<h5>C++11: Inicialização uniforme</h5><p>Algumas mudanças no C++11 são tão grandes que têm o potencial de deixar a linguagem muito melhor, porém irreconhecível. Além do recurso de lambda (do que eu já falei) os recursos de inicialização uniforme e nova sintaxe para declaração de funções são desse tipo. Hoje vou falar sobre Uniform Initialization (ou inicialização uniforme em bom português). 

<p>O C++ tem a característica de não ser uma linguagem uniforme. Isso quer dizer que uma sequência específica de tokens pode ter significados diferentes dependendo do contexto. Isso causa diversos problemas, entre ele uma dificuldade bem maior para escrever um parser (interpretador) para a linguagem. Veja a seguinte expressão:

<div id="selectable">
				<ol class="cpp"><li class="li1"><div class="de1">MeuObjeto algumaCoisa<span class="br0">(</span><span class="nu0">10</span>, <span class="st0">"lala"</span><span class="br0">)</span><span class="sy4">;</span></div></li>
</ol>
			</div>

<p>Esse código pode significar duas coisas: uma declaração de função que retorna MeuObjeto ou a declaração de uma varíavel do tipo meu objeto que tem um construtor com dois parâmetros. Isso existe devido à algo que é chamado de <a href="https://en.wikipedia.org/wiki/Most_vexing_parse">Most Vexing Parser</a>, ou Interpretador Mais Vexaminoso na língua de Camões. Nesse caso específico, essa linha será interpretada como uma declaração de função, algo bem inconviniente caso o trecho acima esteja dentro de uma função:

<div id="selectable">
				<ol class="cpp"><li class="li1"><div class="de1"><span class="kw2">class</span> MeuObjeto</div></li>
<li class="li1"><div class="de1"><span class="br0">{</span></div></li>
<li class="li1"><div class="de1"><span class="kw2">public</span><span class="sy4">:</span></div></li>
<li class="li1"><div class="de1">&nbsp; MeuObjeto<span class="br0">(</span><span class="kw4">int</span> a, string b<span class="br0">)</span> <span class="br0">{</span><span class="br0">}</span></div></li>
<li class="li2"><div class="de2"><span class="br0">}</span><span class="sy4">;</span></div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li1"><div class="de1"><span class="kw4">int</span> main<span class="br0">(</span><span class="br0">)</span></div></li>
<li class="li1"><div class="de1"><span class="br0">{</span></div></li>
<li class="li1"><div class="de1">&nbsp; <span class="co1">// Parece algo normal, mas isso é um erro de compilação</span></div></li>
<li class="li2"><div class="de2">&nbsp; <span class="co1">// Isso será interpretado como uma declaração de função</span></div></li>
<li class="li1"><div class="de1">&nbsp; MeuObjeto algumaCoisa<span class="br0">(</span><span class="nu0">10</span>, <span class="st0">"lala"</span><span class="br0">)</span><span class="sy4">;</span></div></li>
<li class="li1"><div class="de1"><span class="br0">}</span></div></li>
</ol>
			</div>

<p>Para resolver esse problema, entre outros, foi criada a inicialização uniforme:

<div id="selectable">
				<ol class="cpp"><li class="li1"><div class="de1"><span class="kw4">int</span> main<span class="br0">(</span><span class="br0">)</span></div></li>
<li class="li1"><div class="de1"><span class="br0">{</span></div></li>
<li class="li1"><div class="de1">&nbsp; <span class="co1">// Como usamos colchetes ao invés de parenteses, </span></div></li>
<li class="li1"><div class="de1">&nbsp; <span class="co1">// o compilador sabe com certeza que isso é uma chamada</span></div></li>
<li class="li2"><div class="de2">&nbsp; <span class="co1">// de construtor (e não uma declaração de função)</span></div></li>
<li class="li1"><div class="de1">&nbsp; MeuObjeto algumaCoisa<span class="br0">{</span><span class="nu0">10</span>, <span class="st0">"lala"</span><span class="br0">}</span><span class="sy4">;</span></div></li>
<li class="li1"><div class="de1"><span class="br0">}</span></div></li>
</ol>
			</div>

<p>Mas como sempre, a forma anterior de fazer as coisas continua valendo. Lembrem-se: o C++ tem como premissa continuar compatível com todo código fonte que já foi escrito até hoje. Essa é a maldição e a benção do C++: a linguagem evolui e fica competitiva em relação às linguagens mais novas, mas os programadores podem continuar fazendo as coisas da forma antiga e, muitas vezes, pouco recomendáveis. Um exemplo é a parte de gerenciamento de memória. Vou repetir o que digo em quase toda palestra: se você está usando <i>new</i> e <i>delete</i> você está fazendo isso errado.

<p>O recurso de inicialização uniforme permite que toda inicialização de instâncias de objetos e estruturas usem essa nova sintaxe:

<div id="selectable">
				<ol class="cpp"><li class="li1"><div class="de1"><span class="co1">// Lembrando que tipos fundamentais também aceitam</span></div></li>
<li class="li1"><div class="de1"><span class="co1">// a sintaxe de construtor</span></div></li>
<li class="li1"><div class="de1"><span class="kw4">int</span> i <span class="br0">{</span><span class="nu0">3</span><span class="br0">}</span><span class="sy4">;</span></div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li2"><div class="de2"><span class="co1">// Inclusive um construtor vazio (nesse caso i2 == 0)</span></div></li>
<li class="li1"><div class="de1"><span class="kw4">int</span> i2 <span class="br0">{</span><span class="br0">}</span><span class="sy4">;</span> <span class="co1">// empty braces initialize the object to it's default (0)</span></div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li1"><div class="de1"><span class="co1">// a std:string é uma classe, e aceita uma string</span></div></li>
<li class="li1"><div class="de1"><span class="co1">// literal no construtor</span></div></li>
<li class="li2"><div class="de2">std<span class="sy4">::</span><span class="me2">string</span> s <span class="br0">{</span><span class="st0">"hello"</span><span class="br0">}</span><span class="sy4">;</span></div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li1"><div class="de1">MeuObjeto algumaCoisa <span class="br0">{</span><span class="nu0">10</span>, <span class="st0">"lala"</span><span class="br0">}</span><span class="sy4">;</span></div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li1"><div class="de1">MeuObjeto muitasCoisas<span class="br0">[</span><span class="br0">]</span> <span class="sy1">=</span> <span class="br0">{</span> <span class="br0">{</span><span class="nu0">10</span>, <span class="st0">"lala"</span><span class="br0">}</span>, <span class="br0">{</span><span class="nu0">20</span>, <span class="st0">"lili"</span><span class="br0">}</span> <span class="br0">}</span><span class="sy4">;</span></div></li>
</ol>
			</div>

<p>É uma pequena mudança que resolve grandes problemas.<br><p class="datetime">Em 17/02/2016 06:43, por  Rodrigo Strauss </p>
</div>
          </td>
        </tr>



<tr>
<td class="topmenu"></td>
<td>
<br>
<center>

<script type="text/javascript"><!--
google_ad_client = "pub-2589539519655496";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_type = "text";
google_ad_channel = "";
google_color_border = "FFFFFF";
google_color_bg = "FFFFFF";
google_color_link = "FF5000";
google_color_text = "000000";
google_color_url = "FF5000";
google_ui_features = "rc:6";
//-->
</script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>

</center>
</td>
</tr>

<tr>
 <td class="topmenu"></td>
 <td>
  <table style="margin: 0px" cellspacing="0" cellpadding="0" width="100%" border="0">
   <tr>
    <td><img src="../../../images/rebarba3.png"></td>
    <td align="right"><img src="../../../images/rebarba4.png"></td>
   </tr>
  </table>
 </td>
</tr>

<tr><td class="topmenu">&nbsp;</td><td class="topmenu">&nbsp;</td></tr>
<tr><td class="topmenu">&nbsp;</td><td>
<table style="MARGIN: 0px" cellspacing="0" cellpadding="0" width="100%" border="0">
            <tr>
              <td><img src="../../../images/rebarba1.png"></td>
              <td align="right"><img src="../../../images/rebarba2.png"></td>
              </tr>
            </table>
</td>
</tr>
 <tr><td class="topmenu">&nbsp;</td>
<td>

<div class="content">
<a name="comments"></a><h5>Comentários</h5><div class="post_comment">
<a name="3097"></a><B>Teston</B>  | em 20/02/2016 | <a rel="nofollow" href="../#3097">#</a><br>
New/delete é citado como má prática, o que eu concordo quando é feito de forma descontrolada. A alternativa é escolher entre o uso da stack ou smart pointers. <br><br>Não discordo das afirmações acima, porém eu não vejo mal em usar new/delete ou mesmo malloc/free dependendo do contexto. Exemplos de contextos válidos na minha opinião são dentro de objetos RAII ou PImpl por exemplo. Em ambos os contextos não há risco de leaks considerando implementações corretas.<br><br>Minha pergunta aqui: minhas afirmações estão corretas ou estou deixando passar algo? 
</div>
<div class="post_comment_strauss">
<a name="3098"></a><B>Rodrigo Strauss</B>  | <a rel="nofollow" href="http://www.1bit.com.br">website</a> | em 22/02/2016 | <a rel="nofollow" href="../#3098">#</a><br>
Você tem razão, eu exagerei um pouco. Uma afirmação melhor seria que em 99% das situações não há motivos para usar new e delete.
</div>
<div class="post_comment_strauss">
<a name="3099"></a><B>Rodrigo Strauss</B>  | <a rel="nofollow" href="http://www.1bit.com.br">website</a> | em 22/02/2016 | <a rel="nofollow" href="../#3099">#</a><br>
Você tem razão, eu exagerei um pouco. Uma afirmação melhor seria que em 99% das situações não há motivos para usar new e delete.
</div>



</div>

</td></tr>



















<tr>
          <td class="topmenu"></td>
          <td>
          <table style="margin: 0px" cellspacing="0" cellpadding="0" width="100%" border="0">
            <tr>
              <td><img src="../../../images/rebarba3.png" alt="rebarba"></td>
              <td align="right"><img src="../../../images/rebarba4.png" alt="rebarba"></td>
            </tr>
          </table>
          </td>
        </tr>

        <tr>
          <td class="topmenu">&nbsp;</td>
          <td class="topmenu" height="25" align="right" style="color:#999999;">
::::
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          </td>
        </tr>
    </table>
  </body>
</html>
